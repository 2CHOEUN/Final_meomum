<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mm.member">
	<insert id="insertJoin" parameterType="com.mm.member.model.MemberDTO">
		insert into member values(
									member_user_idx.nextval,
									#{user_id},
									#{user_jointype},
									#{user_info},
									#{user_pwd},
									#{user_name},
									#{user_pcode},
									#{user_addr},
									#{addr_detail},
									#{user_tel},
									sysdate,
									#{tos},
									#{user_pia},
									''
									)
	</insert>
	
	
	<select id="login" parameterType="String" resultType="com.mm.member.model.MemberDTO">
		select * from member where user_id = #{user_id }	
	</select>
	
	
	<select id="getsessionInfo" parameterType="String" resultType="com.mm.member.model.MemberDTO">
		select * from member where user_id = #{user_id }
	</select>
	
	
	<update id="updateUserInfo" parameterType="com.mm.member.model.MemberDTO">
		update member set user_name = #{user_name},
						user_pcode = #{user_pcode},
						user_addr = #{user_addr},
						addr_detail = #{addr_detail},
						user_tel = #{user_tel}
					where user_idx = #{user_idx}
	</update>
	
	
	<select id="getuserInfo" parameterType="Integer" resultType="com.mm.member.model.MemberDTO">
		select * from member where user_idx = #{user_idx}
	</select>
	
	
	<update id="updatePWD" parameterType="Map">
		update member set user_pwd = #{newPwd} where user_idx =#{user_idx} 
	</update>
	
	<select id="getuserTTCnt" resultType="Integer" parameterType="String">
	  SELECT COUNT(*) FROM member 
	 	 WHERE user_idx LIKE #{fvalue} or 
	 	 	user_id LIKE #{fvalue} or
	 	 	user_name LIKE #{fvalue} or
	 	 	user_tel LIKE #{fvalue}
	</select>
	<select id="memberList" parameterType="Map" resultType="com.mm.member.model.MemberDTO">
    select * from 
    (
        select rownum as rnum,a.* from
        (
            select * from member 
            <if test="fvalue != null">
                	 WHERE user_idx LIKE #{fvalue} or 
					 	 	user_id LIKE #{fvalue} or
					 	 	user_name LIKE #{fvalue} or
					 	 	user_tel LIKE #{fvalue}
            </if>
              <choose>
				  <when test="orderby== 2">
				    ORDER BY user_name
				  </when>
				  <when test="orderby== 3">
				    ORDER BY user_idx asc
				  </when>
				  <when test="orderby== 4">
				    ORDER BY joindate DESC
				  </when>
				  <when test="orderby== 5">
				    ORDER BY joindate
				  </when>
				  <otherwise>
				    ORDER BY user_idx DESC
				  </otherwise>
			</choose>
        )a
    )b
    where rnum <![CDATA[>=]]> #{start} and rnum <![CDATA[<=]]> #{end}
    
</select>

	
	
</mapper> 